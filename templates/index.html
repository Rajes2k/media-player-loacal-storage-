<img id="thumb-{{loop.index}}" src="/static/placeholder.jpg" data-video-url="/uploads/{{v}}">
<script>
async function captureThumb(imgEl, videoUrl) {
  try {
    const video = document.createElement('video');
    video.crossOrigin = "anonymous";
    video.src = videoUrl;
    video.muted = true;
    await video.play().catch(()=>{}); // some browsers block autoplay
    video.currentTime = 0.6;
    await new Promise(res => video.onseeked = res);
    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    imgEl.src = canvas.toDataURL('image/jpeg');
    video.pause();
  } catch(err){
    console.warn('thumb capture failed', err);
  }
}
document.querySelectorAll('img[data-video-url]').forEach(img=>{
  captureThumb(img, img.dataset.videoUrl);
});
</script>
