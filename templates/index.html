<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rajes Media Player</title>
<style>
  :root{
    --bg-dark:#0b0f12;
    --panel-dark:#14181b;
    --muted-dark:rgba(255,255,255,0.75);
    --accent:#00bcd4;
    --card-shadow: 0 6px 20px rgba(0,0,0,0.5);

    --bg-light:#f6f7f9;
    --panel-light:#ffffff;
    --muted-light:rgba(0,0,0,0.7);
  }

  /* base */
  html,body{height:100%;margin:0;font-family:Inter, "Segoe UI", Arial, sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}
  body{background:var(--bg-dark);color:var(--muted-dark);transition:background .25s,color .25s}
  body.light{background:var(--bg-light);color:var(--muted-light)}

  header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:var(--panel-dark);box-shadow:var(--card-shadow)}
  body.light header{background:var(--panel-light)}
  h1{margin:0;color:var(--accent);font-size:18px;display:flex;align-items:center;gap:8px}
  .top-actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap}

  /* controls */
  .btn {
    background:var(--accent); color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:700;
    display:inline-flex; align-items:center; gap:8px;
  }
  .btn.ghost { background:transparent; border:2px solid var(--accent); color:var(--accent); font-weight:700; padding:6px 10px; }

  input[type="file"]{display:none;}

  /* indicator badges (emoji) */
  .indicator{display:inline-flex;align-items:center;gap:8px;font-weight:700;padding:6px 8px;border-radius:8px;background:transparent;border:2px solid transparent}
  .indicator .icon{font-size:18px}

  /* layout */
  .controls-row{padding:14px 16px;display:flex;align-items:center;gap:12px;justify-content:space-between}
  .controls-left{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .controls-right{display:flex;gap:10px;align-items:center;flex-wrap:wrap}

  /* gallery grid */
  .gallery{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px;padding:18px;max-width:1200px;margin:0 auto}
  .gallery.list{display:flex;flex-direction:column;gap:10px;padding:10px 18px}

  .card{
    background:var(--panel-dark);border-radius:12px;overflow:hidden;box-shadow:var(--card-shadow);transition:transform .18s ease,box-shadow .18s ease;display:flex;flex-direction:column;
  }
  body.light .card{background:var(--panel-light);box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  .card:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(0,0,0,0.35)}

  /* list style card: row */
  .card.row{flex-direction:row;align-items:center;padding:8px;height:110px}
  .thumb-wrap{position:relative;flex:0 0 160px;height:90px;overflow:hidden;border-radius:10px;margin:10px}
  .thumb{width:100%;height:100%;object-fit:cover;display:block;background:#000}
  .duration-badge{position:absolute;bottom:8px;right:8px;background:rgba(0,0,0,0.6);color:#fff;padding:4px 6px;border-radius:6px;font-weight:700;font-size:12px}

  .meta{padding:12px;text-align:left;display:flex;flex-direction:column;gap:6px;flex:1}
  .meta h3{margin:0;font-size:15px;color:var(--muted-dark);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  body.light .meta h3{color:var(--muted-light)}
  .meta .tags{display:flex;gap:8px;flex-wrap:wrap}
  .tag{background:rgba(0,0,0,0.35);color:#fff;padding:6px 8px;border-radius:6px;font-weight:700;font-size:12px}
  body.light .tag{background:rgba(0,0,0,0.06);color:var(--muted-light)}

  .meta .detail-row{display:flex;gap:12px;flex-wrap:wrap;font-size:13px;color:var(--muted-dark)}
  body.light .meta .detail-row{color:var(--muted-light)}

  /* small animations */
  .pulse { animation: pulse 1.6s infinite; }
  @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.02)}100%{transform:scale(1)}}

  /* player overlay */
  #player-container{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:9999;align-items:center;justify-content:center}
  #player-box{width:95%;max-width:1100px;max-height:92%;display:flex;flex-direction:column;align-items:center;gap:12px}
  #player{width:100%;height:auto;background:#000;border-radius:8px;outline:none}
  #audioPlayer{width:100%;display:none}
  #close{position:absolute;right:18px;top:12px;font-size:22px;color:#fff;background:transparent;border:none;cursor:pointer}

  /* footer */
  footer{padding:12px;text-align:center;color:rgba(255,255,255,0.5)}

  /* responsive/list adjustments */
  @media (max-width:700px){
    .thumb-wrap{flex:0 0 120px;height:72px;margin:8px}
    .card.row{height:auto;padding:8px}
    .meta h3{font-size:14px}
    .gallery{grid-template-columns:repeat(auto-fit,minmax(140px,1fr))}
  }
</style>
</head>
<body>
  <header>
    <h1>üé¨ Rajes Media Player</h1>
    <div class="top-actions">
      <span id="themeIndicator" class="indicator" title="Theme"><span class="icon">üåô</span></span>
      <span id="viewIndicator" class="indicator" title="View"><span class="icon">üî≤</span></span>
    </div>
  </header>

  <div class="controls-row">
    <div class="controls-left">
      <label class="btn" for="fileInput">üìÇ Select Files</label>
      <input id="fileInput" type="file" accept="video/*,audio/*" multiple>

      <label class="btn" for="folderInput">üìÅ Select Folder</label>
      <input id="folderInput" type="file" accept="video/*,audio/*" webkitdirectory>

      <select id="typeFilter" class="btn ghost" title="Filter type">
        <option value="all">All types</option>
        <option value="video">Video</option>
        <option value="audio">Audio</option>
      </select>

      <select id="sortSelect" class="btn ghost" title="Sort">
        <option value="type">Sort: Type</option>
        <option value="title">Title</option>
        <option value="date">Date</option>
        <option value="length">Length</option>
        <option value="size">Size</option>
        <option value="resolution">Resolution</option>
      </select>
    </div>

    <div class="controls-right">
      <button id="viewToggle" class="btn ghost" title="Toggle grid/list">üî≤ Grid</button>
      <button id="themeToggle" class="btn ghost" title="Toggle theme">üåô Dark</button>
    </div>
  </div>

  <main>
    <div id="gallery" class="gallery"></div>
  </main>

  <div id="player-container">
    <div id="player-box">
      <button id="close" title="Close">‚úñ</button>
      <video id="player" controls playsinline webkit-playsinline></video>
      <audio id="audioPlayer" controls></audio>
      <div id="player-meta" style="color:#fff;font-size:13px;width:100%;text-align:left"></div>
    </div>
  </div>

  <footer>¬© 2025 Rajes Media Player ‚Äî All features intact</footer>

<script>
/* ---------- State ---------- */
const galleryEl = document.getElementById('gallery');
const fileInput = document.getElementById('fileInput');
const folderInput = document.getElementById('folderInput');
const typeFilter = document.getElementById('typeFilter');
const sortSelect = document.getElementById('sortSelect');
const viewToggle = document.getElementById('viewToggle');
const themeToggle = document.getElementById('themeToggle');
const themeIndicator = document.getElementById('themeIndicator');
const viewIndicator = document.getElementById('viewIndicator');

const playerContainer = document.getElementById('player-container');
const player = document.getElementById('player');
const audioPlayer = document.getElementById('audioPlayer');
const closeBtn = document.getElementById('close');
const playerMeta = document.getElementById('player-meta');

let allFiles = []; // objects: {file, url, metadata, thumbUrl, played}
let isListView = false;
let isLight = false;

/* ---------- Utilities ---------- */
function formatBytes(bytes){
  if(bytes === 0) return '0 B';
  const k = 1024, sizes = ['B','KB','MB','GB','TB'];
  const i = Math.floor(Math.log(bytes)/Math.log(k));
  return parseFloat((bytes/Math.pow(k,i)).toFixed(2)) + ' ' + sizes[i];
}
function formatTime(s){
  s = Number(s) || 0;
  const h = Math.floor(s/3600);
  const m = Math.floor((s%3600)/60);
  const sec = Math.floor(s%60);
  if(h>0) return `${h}:${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;
  return `${m}:${String(sec).padStart(2,'0')}`;
}

/* ---------- Thumbnail capture at 1/4 duration ---------- */
async function captureThumbnail(url){
  return new Promise((resolve) => {
    const v = document.createElement('video');
    v.crossOrigin = "anonymous";
    v.muted = true;
    v.preload = 'metadata';
    v.src = url;

    // fallback canvas in case of errors
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');

    let resolved = false;
    const cleanup = ()=>{ try{ v.src=''; v.load(); }catch(e){} };

    v.addEventListener('loadedmetadata', async () => {
      const t = Math.max(0.1, (v.duration || 0) * 0.25);
      // set size for canvas
      canvas.width = Math.min(480, v.videoWidth || 480);
      canvas.height = Math.round(canvas.width * ((v.videoHeight||270)/(v.videoWidth||480)));
      // seek to quarter
      function onSeek(){
        try{
          ctx.drawImage(v, 0, 0, canvas.width, canvas.height);
          const dataUrl = canvas.toDataURL('image/jpeg', 0.75);
          if(!resolved){ resolved = true; cleanup(); resolve({thumb:dataUrl, width:v.videoWidth, height:v.videoHeight}); }
        }catch(e){
          if(!resolved){ resolved=true; cleanup(); resolve({thumb:null, width:v.videoWidth, height:v.videoHeight}); }
        }
      }
      // if duration 0 or seek not supported, fallback to drawing first frame after short delay
      v.currentTime = Math.min(t, v.duration || t);
      v.addEventListener('seeked', onSeek, {once:true});
      // timeout fallback
      setTimeout(()=>{ if(!resolved){ try{ ctx.drawImage(v,0,0,canvas.width,canvas.height); }catch(_){} resolved=true; cleanup(); resolve({thumb:canvas.toDataURL('image/jpeg',0.7), width:v.videoWidth, height:v.videoHeight}); } }, 900);
    });

    v.addEventListener('error', ()=>{
      if(!resolved){ resolved=true; cleanup(); resolve({thumb:null,width:0,height:0}); }
    });
  });
}

/* ---------- Try to estimate FPS (best effort) ---------- */
async function estimateFPS(fileUrl, duration){
  return new Promise((resolve)=>{
    try{
      // create video and try to use getVideoPlaybackQuality if available
      const v = document.createElement('video');
      v.preload='metadata';
      v.muted=true;
      v.src = fileUrl;
      v.addEventListener('loadedmetadata', ()=>{
        // play briefly muted to allow measurement (some browsers need play)
        const tryMeasure = ()=>{
          try{
            if(typeof v.getVideoPlaybackQuality === 'function'){
              const q = v.getVideoPlaybackQuality();
              if(q && q.totalVideoFrames && duration > 0){
                const fps = Math.round(q.totalVideoFrames / duration);
                resolve(fps || 'Unknown');
                v.src=''; return;
              }
            }
            // some browsers expose mozDecodedFrames / webkitDecodedFrameCount
            const frames = v.webkitDecodedFrameCount || v.mozPaintCount || 0;
            if(frames && duration>0){
              resolve(Math.round(frames/duration) || 'Unknown'); v.src=''; return;
            }
            resolve('Unknown');
            v.src='';
          }catch(e){ resolve('Unknown'); v.src=''; }
        };
        // try to play silently for short time (may be blocked) but we'll still try measure
        v.play().then(()=>{ setTimeout(()=>{ v.pause(); tryMeasure(); }, 300); }).catch(()=>{ tryMeasure(); });
      });
      v.addEventListener('error', ()=>resolve('Unknown'));
    }catch(e){ resolve('Unknown'); }
  });
}

/* ---------- Build card markup ---------- */
function buildCard(item, idx){
  const isVideo = item.file.type.startsWith('video/');
  const card = document.createElement('div');
  card.className = 'card' + (isListView ? ' row' : '');

  // thumbnail
  const thumbWrap = document.createElement('div');
  thumbWrap.className = 'thumb-wrap';
  const img = document.createElement('img');
  img.className = 'thumb';
  img.alt = item.file.name;
  if(item.thumbUrl) img.src = item.thumbUrl;
  else img.style.background = '#000';
  thumbWrap.appendChild(img);

  // duration badge (if known)
  const durBadge = document.createElement('div');
  durBadge.className = 'duration-badge';
  durBadge.textContent = item.metadata && item.metadata.duration ? formatTime(item.metadata.duration) : '00:00';
  thumbWrap.appendChild(durBadge);

  // meta
  const meta = document.createElement('div');
  meta.className = 'meta';
  const title = document.createElement('h3'); title.textContent = item.file.name;
  const tagRow = document.createElement('div'); tagRow.className = 'tags';
  const tagType = document.createElement('span'); tagType.className='tag'; tagType.textContent = item.file.type.split('/')[0].toUpperCase();
  tagRow.appendChild(tagType);

  // detail row: length, resolution, fps, size, date, playedTime
  const details = document.createElement('div'); details.className = 'detail-row';
  const lengthEl = document.createElement('div'); lengthEl.textContent = 'Length: ' + (item.metadata.duration? formatTime(item.metadata.duration) : 'Unknown');
  const resEl = document.createElement('div'); resEl.textContent = 'Res: ' + (item.metadata.width ? `${item.metadata.width}x${item.metadata.height}` : 'Unknown');
  const fpsEl = document.createElement('div'); fpsEl.textContent = 'FPS: ' + (item.metadata.fps || 'Unknown');
  const sizeEl = document.createElement('div'); sizeEl.textContent = 'Size: ' + formatBytes(item.file.size);
  const dateEl = document.createElement('div'); dateEl.textContent = 'Date: ' + new Date(item.file.lastModified).toLocaleDateString();
  const playedEl = document.createElement('div'); playedEl.textContent = 'Played: ' + (item.played? formatTime(item.played) : '0:00');
  details.append(lengthEl,resEl,fpsEl,sizeEl,dateEl,playedEl);

  meta.append(title, tagRow, details);

  // click behavior - open in native player overlay
  const openPlayer = (e)=>{
    e.stopPropagation();
    openInPlayer(idx);
  };
  thumbWrap.addEventListener('click', openPlayer);
  meta.addEventListener('click', openPlayer);

  // append to card
  card.appendChild(thumbWrap);
  card.appendChild(meta);

  // subtle animation for new items
  card.style.opacity = 0; setTimeout(()=>{ card.style.opacity = 1; }, 40);

  // add to gallery
  return card;
}

/* ---------- Render gallery ---------- */
function renderGallery(){
  galleryEl.innerHTML = '';
  const filter = typeFilter.value;
  const filesToShow = allFiles.filter(it => (filter==='all' ? true : it.file.type.startsWith(filter)));

  // apply sort
  const sortBy = sortSelect.value;
  filesToShow.sort((a,b)=>{
    if(sortBy==='title') return a.file.name.localeCompare(b.file.name);
    if(sortBy==='type') return a.file.type.localeCompare(b.file.type);
    if(sortBy==='date') return a.file.lastModified - b.file.lastModified;
    if(sortBy==='size') return a.file.size - b.file.size;
    if(sortBy==='length'){
      const da = a.metadata.duration || 0, db = b.metadata.duration || 0; return da - db;
    }
    if(sortBy==='resolution'){
      const ra = (a.metadata.width||0)*(a.metadata.height||0), rb = (b.metadata.width||0)*(b.metadata.height||0); return rb - ra;
    }
    return 0;
  });

  // grid or list classes
  galleryEl.classList.toggle('list', isListView);

  filesToShow.forEach((it, idx)=>{
    const card = buildCard(it, idx);
    // on list view we want row look
    if(isListView) card.classList.add('row');
    galleryEl.appendChild(card);
  });
}

/* ---------- Open in native browser player overlay ---------- */
function openInPlayer(index){
  const item = allFiles[index];
  if(!item) return;
  // cleanup previous
  player.pause(); audioPlayer.pause();
  player.removeAttribute('src'); audioPlayer.removeAttribute('src');

  const url = item.url;
  const isVideo = item.file.type.startsWith('video/');
  playerContainer.style.display = 'flex';

  if(isVideo){
    audioPlayer.style.display = 'none';
    player.style.display = 'block';
    player.src = url;
    player.currentTime = item.played || 0;
    // update meta area
    playerMeta.textContent = `${item.file.name} ‚Ä¢ ${item.metadata.width ? item.metadata.width + 'x' + item.metadata.height : 'Res: unknown'} ‚Ä¢ ${item.file.size ? formatBytes(item.file.size) : ''}`;
    player.play().catch(()=>{ /* autoplay blocked until user interacts, fine */ });
    // track playing time while open
    player.ontimeupdate = ()=>{ item.played = player.currentTime; renderGallery(); };
  } else {
    // audio
    player.style.display = 'none';
    audioPlayer.style.display = 'block';
    audioPlayer.src = url;
    audioPlayer.currentTime = item.played || 0;
    playerMeta.textContent = `${item.file.name} ‚Ä¢ Audio ‚Ä¢ ${item.file.size ? formatBytes(item.file.size) : ''}`;
    audioPlayer.play().catch(()=>{ /* may require user gesture */});
    audioPlayer.ontimeupdate = ()=>{ item.played = audioPlayer.currentTime; renderGallery(); };
  }
}

/* ---------- Event handlers for inputs ---------- */
fileInput.addEventListener('change', async (e)=>{
  const files = Array.from(e.target.files || []);
  await ingestFiles(files);
});
folderInput.addEventListener('change', async (e)=>{
  const files = Array.from(e.target.files || []);
  await ingestFiles(files);
});

typeFilter.addEventListener('change', renderGallery);
sortSelect.addEventListener('change', renderGallery);

viewToggle.addEventListener('click', ()=>{
  isListView = !isListView;
  viewToggle.textContent = isListView ? 'üìã List' : 'üî≤ Grid';
  viewIndicator.querySelector('.icon').textContent = isListView ? 'üìã' : 'üî≤';
  renderGallery();
});

/* theme toggle */
themeToggle.addEventListener('click', ()=>{
  isLight = !isLight;
  document.body.classList.toggle('light', isLight);
  themeToggle.textContent = isLight ? '‚òÄÔ∏è Light' : 'üåô Dark';
  themeIndicator.querySelector('.icon').textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
});

/* player close */
closeBtn.addEventListener('click', ()=>{
  try{ player.pause(); audioPlayer.pause(); }catch(e){}
  playerContainer.style.display = 'none';
});

/* ---------- Ingest files, compute metadata & thumbs ---------- */
async function ingestFiles(fileList){
  // process files, gather metadata and thumb
  for(const f of fileList){
    if(!f.type || (!f.type.startsWith('video/') && !f.type.startsWith('audio/'))) continue;
    const url = URL.createObjectURL(f);
    const entry = { file: f, url: url, metadata: {}, thumbUrl: null, played: 0 };

    // set size/date quickly
    entry.metadata.size = f.size;
    entry.metadata.date = f.lastModified;

    if(f.type.startsWith('video/')){
      try{
        // capture thumbnail at 1/4 duration
        const {thumb, width, height} = await captureThumbnail(url);
        entry.thumbUrl = thumb;
        entry.metadata.width = width;
        entry.metadata.height = height;
      }catch(e){
        entry.thumbUrl = null;
      }

      // create short video element to load metadata duration
      const v = document.createElement('video');
      v.preload = 'metadata';
      v.muted = true;
      v.src = url;
      await new Promise((res)=>{ v.addEventListener('loadedmetadata', ()=>res(), {once:true}); v.addEventListener('error', ()=>res(), {once:true}); });
      entry.metadata.duration = v.duration || 0;
      // try estimate fps
      entry.metadata.fps = await estimateFPS(url, entry.metadata.duration);
    } else {
      // audio file: use a tiny audio element to get duration
      const a = document.createElement('audio'); a.preload='metadata'; a.src = url;
      await new Promise((res)=>{ a.addEventListener('loadedmetadata', ()=>res(), {once:true}); a.addEventListener('error', ()=>res(), {once:true}); });
      entry.metadata.duration = a.duration || 0;
      // set generic thumb (blank) or icon
      entry.thumbUrl = null;
    }
    allFiles.push(entry);
    // small animation effect: new items pulse once
    renderGallery();
  }
  // default sort by type
  sortSelect.value = sortSelect.value || 'type';
  renderGallery();
}

/* ---------- Remove path field (we do not display path) ---------- */
/* path intentionally not shown per request */

/* ---------- Fix audio mobile blank issues ---------- */
/*
  - We show the audioPlayer element when playing audio items.
  - On iOS/Android the playback will start only after user gesture; clicking the item is a user gesture.
  - Ensure audioPlayer.controls is visible; set audioPlayer.src and call play() inside openInPlayer.
*/

/* ---------- Cleanup object URLs on unload ---------- */
window.addEventListener('beforeunload', ()=>{
  allFiles.forEach(it => { try{ URL.revokeObjectURL(it.url); }catch(e){} });
});

/* ---------- Accessibility: keyboard open/close ---------- */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape') { if(playerContainer.style.display==='flex') closeBtn.click(); }
});

/* ---------- Nice initial demo state instructions ---------- */
(function init(){
  viewToggle.textContent = 'üî≤ Grid';
  themeToggle.textContent = 'üåô Dark';
  themeIndicator.querySelector('.icon').textContent = 'üåô';
  viewIndicator.querySelector('.icon').textContent = 'üî≤';
  // subtle hint
  setTimeout(()=>{ /* no-op */ }, 200);
})();

</script>
</body>
</html>
